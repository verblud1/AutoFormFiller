# API документация AutoFormFiller

## Обзор

AutoFormFiller предоставляет программный интерфейс для работы с данными семей и автоматизации заполнения форм. API разделен на два основных компонента: создатель JSON файлов и массовый обработчик.

## Общие модули

### utils.data_processing

Функции для обработки и очистки данных:

#### `clean_string(text)`
Очищает строку от специальных символов и нормализует пробелы.

- **Параметры**: `text` (str) - строка для очистки
- **Возвращает**: str - очищенная строка

#### `clean_fio(fio)`
Очищает и нормализует ФИО.

- **Параметры**: `fio` (str) - ФИО для очистки
- **Возвращает**: str - очищенное ФИО

#### `clean_address(address)`
Очищает и нормализует адрес.

- **Параметры**: `address` (str) - адрес для очистки
- **Возвращает**: str - очищенный адрес

#### `clean_date(date_str)`
Очищает и валидирует дату.

- **Параметры**: `date_str` (str) - строка даты для очистки
- **Возвращает**: str - очищенная дата в формате ДД.ММ.ГГГГ

#### `clean_phone(phone)`
Очищает и форматирует телефон.

- **Параметры**: `phone` (str) - телефон для форматирования
- **Возвращает**: str - отформатированный телефон

#### `clean_numeric_field(value)`
Очищает числовые поля.

- **Параметры**: `value` (str) - числовое значение для очистки
- **Возвращает**: str - очищенное числовое значение

#### `clean_family_data(family_data)`
Очищает все данные семьи.

- **Параметры**: `family_data` (dict) - словарь с данными семьи
- **Возвращает**: dict - очищенные данные семьи

#### `parse_date(date_string)`
Парсинг даты из различных форматов.

- **Параметры**: `date_string` (str) - строка даты
- **Возвращает**: str - дата в формате ДД.ММ.ГГГГ

#### `format_phone(phone_string)`
Форматирование телефона в формат 7XXXXXXXXXX.

- **Параметры**: `phone_string` (str) - строка телефона
- **Возвращает**: str - отформатированный телефон

### utils.validation

Функции для валидации данных:

#### `validate_date(date_string)`
Проверка корректности даты.

- **Параметры**: `date_string` (str) - строка даты
- **Возвращает**: bool - корректна ли дата

#### `validate_number(value)`
Проверка корректности числа.

- **Параметры**: `value` (str) - строка числа
- **Возвращает**: bool - корректно ли число

#### `validate_phone(phone)`
Проверка корректности телефона.

- **Параметры**: `phone` (str) - строка телефона
- **Возвращает**: bool - корректен ли телефон

#### `validate_family_data(family_data)`
Проверка данных семьи.

- **Параметры**: `family_data` (dict) - словарь с данными семьи
- **Возвращает**: list[str] - список ошибок валидации

### utils.file_utils

Функции для работы с файлами и конфигурацией:

#### `setup_config_directory(base_dir)`
Создание папки для конфигурационных файлов.

- **Параметры**: `base_dir` (str) - базовая директория
- **Возвращает**: tuple[str, str, str] - директории конфигурации, скриншотов и логов

#### `load_config(config_file, default_config)`
Загрузка конфигурации из файла.

- **Параметры**: 
  - `config_file` (str) - путь к файлу конфигурации
  - `default_config` (dict) - конфигурация по умолчанию
- **Возвращает**: dict - загруженная конфигурация

#### `save_config(config_file, config)`
Сохранение конфигурации в файл.

- **Параметры**: 
  - `config_file` (str) - путь к файлу конфигурации
  - `config` (dict) - конфигурация для сохранения
- **Возвращает**: bool - успешно ли сохранено

#### `find_registry_directory(start_dir)`
Поиск папки registry относительно текущего файла.

- **Параметры**: `start_dir` (str) - начальная директория
- **Возвращает**: str - путь к папке registry

#### `load_last_files(register_dir, adpi_dir)`
Загрузка последних файлов реестра и АДПИ при запуске.

- **Параметры**: 
  - `register_dir` (str) - директория реестра
  - `adpi_dir` (str) - директория АДПИ
- **Возвращает**: tuple[str, str] - пути к последним файлам

### utils.excel_utils

Функции для работы с Excel файлами:

#### `load_register_file(file_path)`
Загрузка реестра многодетных из xls/xlsx файла.

- **Параметры**: `file_path` (str) - путь к файлу реестра
- **Возвращает**: dict - загруженные данные реестра

#### `load_adpi_file(file_path)`
Загрузка данных АДПИ из xlsx файла.

- **Параметры**: `file_path` (str) - путь к файлу АДПИ
- **Возвращает**: dict - загруженные данные АДПИ

#### `parse_adpi_date(date_string)`
Парсинг даты из АДПИ файла с обработкой двух дат.

- **Параметры**: `date_string` (str) - строка даты
- **Возвращает**: str - очищенная дата

#### `parse_single_date(date_string)`
Парсинг одной даты.

- **Параметры**: `date_string` (str) - строка даты
- **Возвращает**: str - очищенная дата

#### `normalize_fio(fio)`
Нормализация ФИО для сравнения.

- **Параметры**: `fio` (str) - ФИО для нормализации
- **Возвращает**: str - нормализованное ФИО

#### `is_fio_similar(search_fio, target_fio)`
Проверка похожести ФИО.

- **Параметры**: 
  - `search_fio` (str) - искомое ФИО
  - `target_fio` (str) - целевое ФИО
- **Возвращает**: bool - похожи ли ФИО

### utils.family_processor

Класс для обработки данных семей:

#### `FamilyDataProcessor`
Класс для обработки данных семей.

##### `collect_family_data(form_data)`
Сбор данных из формы в словарь.

- **Параметры**: `form_data` (dict) - данные формы
- **Возвращает**: dict - собранные данные семьи

##### `validate_family(family_data)`
Проверка данных семьи.

- **Параметры**: `family_data` (dict) - данные семьи
- **Возвращает**: list[str] - список ошибок валидации

##### `calculate_unified_benefit(children_count, percentage_str)`
Расчет единого пособия.

- **Параметры**: 
  - `children_count` (int) - количество детей
  - `percentage_str` (str) - процент пособия
- **Возвращает**: int - рассчитанное пособие

##### `fill_from_register_data(register_data, fio)`
Заполнение формы данными из реестра с обработкой возраста.

- **Параметры**: 
  - `register_data` (dict) - данные реестра
  - `fio` (str) - ФИО для поиска
- **Возвращает**: dict - заполненные данные формы

##### `auto_detect_family_from_register(search_fio, mother_fio="", father_fio="")`
Автоматическое определение семьи из реестра с обработкой дубликатов.

- **Параметры**: 
  - `search_fio` (str) - искомое ФИО
  - `mother_fio` (str, optional) - ФИО матери
  - `father_fio` (str, optional) - ФИО отца
- **Возвращает**: tuple[dict, str] - данные формы и сообщение

##### `fill_adpi_from_loaded_data(mother_fio="", father_fio="")`
Заполнение данных АДПИ из загруженного файла по ФИО.

- **Параметры**: 
  - `mother_fio` (str, optional) - ФИО матери
  - `father_fio` (str, optional) - ФИО отца
- **Возвращает**: tuple[dict, str] - данные формы и сообщение

## Компоненты приложения

### family_creator.json_generator

Класс для генерации JSON файлов с семьями:

#### `JSONFamilyCreator`
Класс для генерации JSON файлов с семьями.

##### `save_to_json(file_path)`
Сохранение списка семей в JSON файл.

- **Параметры**: `file_path` (str) - путь к файлу для сохранения
- **Возвращает**: bool - успешно ли сохранено

##### `load_from_json(file_path)`
Загрузка JSON файла.

- **Параметры**: `file_path` (str) - путь к файлу для загрузки
- **Возвращает**: bool - успешно ли загружено

##### `add_family(family_data)`
Добавление семьи в список.

- **Параметры**: `family_data` (dict) - данные семьи
- **Возвращает**: bool - успешно ли добавлено

##### `get_family(index)`
Получение семьи по индексу.

- **Параметры**: `index` (int) - индекс семьи
- **Возвращает**: dict - данные семьи

##### `get_families_count()`
Получение количества семей.

- **Возвращает**: int - количество семей

##### `remove_family(index)`
Удаление семьи по индексу.

- **Параметры**: `index` (int) - индекс семьи
- **Возвращает**: bool - успешно ли удалено

##### `clear_families()`
Очистка списка семей.

- **Возвращает**: None

##### `calculate_unified_benefit(children_count, percentage_str)`
Расчет единого пособия.

- **Параметры**: 
  - `children_count` (int) - количество детей
  - `percentage_str` (str) - процент пособия
- **Возвращает**: int - рассчитанное пособие

### mass_processor.core

Класс для массового обработчика семей:

#### `MassFamilyProcessorGUI`
GUI класс для массового обработчика семей.

##### `start_processing()`
Начало обработки семей с выбором стартовой семьи.

- **Возвращает**: None

##### `process_families()`
Основной цикл обработки семей с повторной обработкой ошибок.

- **Возвращает**: None

##### `process_single_family_with_retry(family_data, family_number)`
Обработка одной семьи с повторными попытками.

- **Параметры**: 
  - `family_data` (dict) - данные семьи
  - `family_number` (int) - номер семьи
- **Возвращает**: bool - успешно ли обработано

##### `stop_processing()`
Остановка обработки.

- **Возвращает**: None

#### `AutoFormFillerMass`
Класс для массовой обработки семей с улучшенной обработкой ошибок.

##### `process_family(family_data, family_number)`
Обработка одной семьи.

- **Параметры**: 
  - `family_data` (dict) - данные семьи
  - `family_number` (int) - номер семьи
- **Возвращает**: bool - успешно ли обработано

##### `_setup_driver()`
Настройка драйвера.

- **Возвращает**: bool - успешно ли настроено

##### `stop_processing()`
Остановка обработки.

- **Возвращает**: None

## Общие GUI компоненты

### common.gui_components

#### `BaseGUI`
Базовый класс для GUI приложений.

##### `setup_base_ui()`
Настройка базового пользовательского интерфейса.

- **Возвращает**: None

##### `setup_mouse_wheel_binding()`
Настройка прокрутки колесиком мыши для всех вкладок.

- **Возвращает**: None

##### `create_income_field(parent, label, key)`
Создание поля для ввода дохода.

- **Параметры**: 
  - `parent` (Widget) - родительский виджет
  - `label` (str) - текст метки
  - `key` (str) - ключ поля
- **Возвращает**: Widget - созданный виджет

##### `log_message(message, log_widget=None)`
Добавление сообщения в лог.

- **Параметры**: 
  - `message` (str) - сообщение
  - `log_widget` (Widget, optional) - виджет лога
- **Возвращает**: None

## Параметры командной строки

### main.py

Приложение принимает следующие аргументы командной строки:

- `--mode` - режим работы приложения (creator, processor, launcher)

Примеры использования:

```bash
# Запуск лаунчера (по умолчанию)
python main.py

# Запуск создателя JSON файлов
python main.py --mode creator

# Запуск массового обработчика
python main.py --mode processor
```

## Формат JSON данных

Структура JSON файла с семьями:

```json
[
  {
    "mother_fio": "Фамилия Имя Отчество матери",
    "mother_birth": "Дата рождения матери",
    "mother_work": "Место работы матери",
    "mother_disability_care": true/false,
    "mother_not_working": true/false,
    "father_fio": "Фамилия Имя Отчество отца",
    "father_birth": "Дата рождения отца",
    "father_work": "Место работы отца",
    "father_not_working": true/false,
    "children": [
      {
        "fio": "ФИО ребенка",
        "birth": "Дата рождения ребенка",
        "education": "Место учебы"
      }
    ],
    "phone_number": "Телефон",
    "address": "Адрес",
    "rooms": "Количество комнат",
    "square": "Площадь",
    "amenities": "Удобства",
    "ownership": "Собственность",
    "adpi": "АДПИ (да/нет)",
    "install_date": "Дата установки АДПИ",
    "check_date": "Дата проверки АДПИ",
    "incomes": {
      "mother_salary": "Зарплата матери",
      "father_salary": "Зарплата отца",
      "unified_benefit": "Единое пособие",
      "large_family_benefit": "Пособие по многодетности",
      "survivor_pension": "Пенсия по потере кормильца",
      "alimony": "Алименты",
      "disability_pension": "Пенсия по инвалидности"
    },
    "other_incomes": "Другие доходы"
  }
]